(function(b,e,d){var a=b(document);d=e.Modernizr;b(document).ready(function(){b.fn.foundationAlerts&&a.foundationAlerts();b.fn.foundationButtons&&a.foundationButtons();b.fn.foundationAccordion&&a.foundationAccordion();b.fn.foundationNavigation&&a.foundationNavigation();b.fn.foundationTopBar&&a.foundationTopBar();b.fn.foundationCustomForms&&a.foundationCustomForms();b.fn.foundationMediaQueryViewer&&a.foundationMediaQueryViewer();b.fn.foundationTabs&&a.foundationTabs({callback:b.foundation.customForms.appendCustomMarkup});
b.fn.foundationTooltips&&a.foundationTooltips();b.fn.foundationMagellan&&a.foundationMagellan();b.fn.foundationClearing&&a.foundationClearing();b.fn.placeholder&&b("input, textarea").placeholder()});d.touch&&!e.location.hash&&b(e).load(function(){setTimeout(function(){e.scrollTo(0,1)},0)})})(jQuery,this);var BundleContentNode=function(){function b(b,d,a,c){this.url=b;this.name=d;this.parent=a;this.children=c}b.prototype.isRootNode=function(){return void 0===this.parent};b.prototype.isLeafNode=function(){return null===this.children};b.prototype.getUrl=function(){return this.url};b.prototype.getName=function(){return this.name};b.prototype.getFullName=function(){return this.isRootNode()?this.name:[this.parent.getFullName(),this.name].join("/")};b.prototype.getParent=function(){return this.parent};b.prototype.getChildren=
function(){return this.children};b.prototype.setChildren=function(b){this.children=b};b.prototype.getData=function(){return this.data};b.prototype.setData=function(b){this.data=b};return b}(),BundleRenderer=function(){function b(b){this.template=b}b.loadContentAsync=function(e,d){console.log("loadContentAsync");$.ajax({type:"GET",url:[d.getUrl(),d.getFullName()].join("/"),cache:!1,success:function(a){console.log(a);console.log("");var c=[];Array.isArray(a)&&2==a.length&&(c=a[0].map(function(a){return new BundleContentNode(d.getUrl(),
a,d)}),a=a[1].map(function(a){return new BundleContentNode(d.getUrl(),a,d,null)}),c=c.concat(a).sort(function(a,c){return a.getName().localeCompare(c.getName())}));d.setChildren(c);b.renderTable(e,b.getContentTableModel(d,e))},error:function(a,c,b){}})};b.loadFileContentAsync=function(e,d){console.log("loadFileContentAsync");$.ajax({type:"GET",url:[d.getUrl().replace("api/bundles/content","api/bundles/filecontent"),d.getFullName()].join("/"),cache:!1,success:function(a){console.log(a);console.log("");
d.setData(a);b.renderTable(e,b.getContentTableModel(d,e))},error:function(a,c,b){}})};b.getContentTableModel=function(e,d){var a=0;!1===e.isRootNode()&&(a+=1);if(e.isLeafNode())a+=1;else{var c=e.getChildren();void 0!==c&&(a+=c.length)}var f=function(a){a.setAttribute("class","col bundle__file_view__icon");var c=document.createElement("i");c.setAttribute("class","fi-arrow-left");a.appendChild(c);c.onclick=function(a){b.loadContentAsync(d,e.getParent());a.preventDefault()}},h=function(a){a.setAttribute("class",
"col bundle-item-type-goup");for(var c=[],f=e.getParent();void 0!==f;)c.push(f),f=f.getParent();c.reverse().forEach(function(c){var f=document.createElement("a");f.textContent=c.getName();f.setAttribute("href","");f.onclick=function(a){b.loadContentAsync(d,c);a.preventDefault()};a.appendChild(f);a.appendChild(document.createTextNode(" / "))});a.appendChild(document.createTextNode(e.getName()))},g=function(a,c){a.setAttribute("class","col bundle__file_view__icon");var b=document.createElement("i");
void 0!==c&&b.setAttribute("class",c.isLeafNode()?"fi-page":"fi-folder");a.appendChild(b)},l=function(a,c){if(c.isLeafNode()){a.setAttribute("class","col");var f=document.createElement("a");f.textContent=c.getName();f.setAttribute("href","");f.onclick=function(a){b.loadFileContentAsync(d,c);a.preventDefault()}}else a.setAttribute("class","col bundle-item-type-folder"),f=document.createElement("a"),f.textContent=c.getName(),f.setAttribute("href",""),f.onclick=function(a){b.loadContentAsync(d,c);a.preventDefault()};
a.appendChild(f)},c=function(a,c){var b=document.createElement("img"),f=[c.getUrl().replace("api/bundles/content","api/bundles/filecontent"),c.getFullName()].join("/");b.setAttribute("src",f);b.setAttribute("style","max-width:900px");return[b]},k=function(a,c){var b=document.createElement("iframe"),f=[c.getUrl().replace("api/bundles/content","api/bundles/filecontent"),c.getFullName()].join("/");b.setAttribute("src",f);b.setAttribute("style","width:100%; min-height:"+Math.max(200,Math.min(900,screen.height/
2))+"px;");return[b]},m={txt:function(a,c){var b=document.createElement("pre");b.setAttribute("class","bundle__file_pre");b.textContent=c.getData();return[b]},htm:k,html:k,jpg:c,png:c},n=function(a,c){var b=c.getName(),f="";0<b.indexOf(".")&&(f=b.toLowerCase().split(".").pop());b=m[f];void 0===b&&(b=m.txt);a.setAttribute("class","col");b(a,c).forEach(function(c){a.appendChild(c)})};return{tableDecorations:"bundle__file_view expanded",rowDecorations:"row",numRows:a,numCols:2,render:function(a,c,b){if(!1===
e.isRootNode()&&0>=a)0==c?f(b):h(b);else if(!0===e.isLeafNode())0==c?g(b):n(b,e);else{var d=0;!1===e.isRootNode()&&(d=1);a=e.getChildren()[a-d];0==c?g(b,a):l(b,a)}}}};b.getMetadataTableModel=function(b){var d=[],a;for(a in b.metadata)console.log(a),"description"==a&&d.push([a,b.metadata[a]]);return{tableDecorations:"bundle__meta_table",rowDecorations:"row",numRows:d.length,numCols:2,render:function(a,b,h){0==b?h.setAttribute("class","col bundle__meta_type"):h.setAttribute("class","col");h.textContent=
d[a][b]}}};b.getElementType=function(b,d){return void 0!==b?b:d};b.renderTable=function(e,d){var a=b.getElementType(d.tableElementType,"table"),c=b.getElementType(d.rowElementType,"tr"),f=b.getElementType(d.columnElementType,"td"),a=document.createElement(a);void 0!==d.tableDecorations&&a.setAttribute("class",d.tableDecorations);for(var h=0;h<d.numRows;h++){var g=document.createElement(c);if(0<d.numCols)for(var l=0;l<d.numCols;l++){var k=document.createElement(f);d.render(h,l,k);g.appendChild(k)}else d.render(h,
g);a.appendChild(g)}void 0!=e.firstChild&&e.removeChild(e.firstChild);e.appendChild(a)};b.prototype.render=function(e){var d=$(this.template.cloneNode(!0));d.find(".bundle-name").text(e.metadata.name);d.find(".bundle-icon-sm").removeClass("bundle-icon-sm").addClass("bundle-icon-sm--"+e.bundle_type+"--"+e.state);d.find(".bundle-uuid").text(e.uuid);d.find(".bundle-link").attr("href","/bundles/"+e.uuid);d.find(".bundle-download").on("click",function(a){a.preventDefault();console.log(a);console.log(c.get(0));
root=new BundleContentNode("/api/bundles/content",e.uuid);console.log(root)});var a=d.find(".bundle-meta-view-container").get(0);b.renderTable(a,b.getMetadataTableModel(e));var a=d.find(".bundle__expand_button"),c=d.find(".bundle-file-view-container");a.on("click",function(a){var d=$(a.target);if(d.hasClass("expanded"))c.removeClass("expanded"),c.children().removeClass("expanded"),d.removeClass("expanded"),d.html('SHOW BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="More">');else{if(void 0==
c.get(0).firstChild){var g=new BundleContentNode("/api/bundles/content",e.uuid);b.loadContentAsync(c.get(0),g)}else c.children().addClass("expanded");c.addClass("expanded");d.addClass("expanded");d.html('HIDE BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="Less">')}a.preventDefault()});return d.get(0)};return b}(),WorkshhetDirectiveRenderer=function(){return function(){var b=this;b.display="inline";b.bundleBlock=null;b.tableDirective=[];b.applyDirective=function(e,d){switch(d[1].directive){case "display":b.display=
d[1].display;b.applyPendingDirectives(e);break;case "image":$(e).append($("<img />",{src:"/api/bundles/filecontent/"+b.bundleBlock.uuid+"/"+encodeURI(d[1].path),"class":"bundleImage",alt:d[1].name}));break;case "metadata":b.tableDirective.push(d[1])}};b.insertRowTable=function(b,d,a){var c=$("<tr></tr>");d.forEach(function(b){c.append($(a).text(b))});b.append(c)};b.getDataFromPath=function(e){return b.bundleBlock.metadata[e]};b.applyPendingDirectives=function(e){if(0<b.tableDirective.length){var d=
$("<table></table>");if("table"===b.display){var a=$("<thead></thead>");b.insertRowTable(a,b.tableDirective.map(function(a){return a.name}),"<th></th>")}var c=$("<tbody></tbody>");"table"===b.display?b.insertRowTable(c,b.tableDirective.map(function(a){return b.getDataFromPath(a.path)}),"<td></td>"):b.tableDirective.forEach(function(a){b.insertRowTable(c,[a.name,b.getDataFromPath(a.path)],"<td></td>")});d.append(a);d.append(c);$(e).append(d);b.tableDirective=[]}}}}(),WorksheetRenderer=function(){return function(b,
e,d){this.renderer=e;if(d&&d.items&&Array.isArray(d.items)){var a=this;e=d.name;var c=d.items.filter(function(a){return"title"===a[2]});0<c.length&&(e=markdown.toHTML("#"+c[0][1]).replace(/^<h1>/,"").replace(/<\/h1>$/,""));$(".worksheet-icon").html(e);$(".worksheet-author").html("by "+d.owner);var f=new WorkshhetDirectiveRenderer,h="";d.items.push([null,"eof",null]);d.items.forEach(function(c,d,e){"directive"!=c[2]&&f.applyPendingDirectives(b);if("markup"!=c[2]&&0<h.length){var m=document.createElement("div");
m.innerHTML=markdown.toHTML(h);b.appendChild(m);h=""}switch(c[2]){case "markup":h+=c[1]+"\n\r";break;case "bundle":b.appendChild(a.renderer.render(c[0]));break;case "directive":e.slice(d+1).forEach(function(a){"bundle"==a[2]&&(f.bundleBlock=a[0])}),f.applyDirective(b,c)}});MathJax.Hub.Queue(["Typeset",MathJax.Hub,b.id]);MathJax.Hub.Queue(function(){for(var a=MathJax.Hub.getAllJax(),c=0;c<a.length;c+=1)$(a[c].SourceElement().parentNode).addClass("coda-jax")})}}}();var Competition;
(function(b){function e(a,c){c?(a.removeClass("leaderBoardSubmit"),a.addClass("leaderBoardRemove"),a.text("Remove from Leaderboard")):(a.removeClass("leaderBoardRemove"),a.addClass("leaderBoardSubmit"),a.text("Submit to Leaderboard"))}function d(a,c,b,d){a="/api/competition/"+a+"/submission/"+c+"/leaderboard";var g="";d.hasClass("leaderBoardSubmit")?g="post":d.hasClass("leaderBoardRemove")&&(g="delete");request=$.ajax({url:a,type:g,datatype:"text",data:{csrfmiddlewaretoken:b},success:function(a,b,
f){(a="post"==g)?(b=$("#user_results td.status"),b.removeClass("submitted"),b.addClass("not_submitted"),b.html(""),b=$("#"+c+" td.status"),b.addClass("submitted"),b.html("<i class='fi-check'></i>"),$("#user_results button.leaderBoardRemove").each(function(a){e($(this),!1)})):(b=$("#"+c+" td.status"),b.removeClass("submitted"),b.addClass("not_submitted"),b.html(""));e(d,a)},error:function(a,b,c){alert("An error occurred. Please try again or report the issue")},beforeSend:function(a){a.setRequestHeader("X-CSRFToken",
b)}})}b.invokePhaseButtonOnOpen=function(a){var b=$("#"+a+" .button.selected")[0];void 0===b&&(b=$("#"+a+" .button.active")[0],void 0===b&&(b=$("#"+a+" .button")[0]));b.click()};b.getPhaseSubmissions=function(a,c,f){$(".competition_submissions").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/submissions/"+c,cache:!1,success:function(c){$(".competition_submissions").html("").append(c);!1===CodaLab.FileUploader.isSupported()?
($("#fileUploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new CodaLab.FileUploader({buttonId:"fileUploadButton",sasEndpoint:"/api/competition/"+a+"/submission/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,b){$("#fileUploadButton").addClass("disabled")},afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===
a.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#fileUploadButton").removeClass("disabled"))},uploadProgress:function(a,b,c){b=100*b/c;$("#details").html("Uploading file <em>"+a.name+"</em>: "+b.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#fileUploadButton").removeClass("disabled")},
uploadSuccess:function(c,f){$("#details").html("Creating new submission...");$.ajax({url:"/api/competition/"+a+"/submission",type:"post",cache:!1,data:{id:f,name:c.name,type:c.type,size:c.size}}).done(function(a){$("#details").html("");$("#user_results tr.noData").remove();$("#user_results").append(b.displayNewSubmission(a));$("#user_results #"+a.id+" .fi-plus").on("click",function(){b.showOrHideSubmissionDetails(this)});$("#fileUploadButton").removeClass("disabled");$("#user_results #"+a.id+" .fi-plus").click()}).fail(function(a){var b=
"An unexpected error occurred.";403==a.status&&(b=a.responseJSON.detail);$("#details").html(b);$("#fileUploadButton").removeClass("disabled")})}});$("#user_results .fi-plus").on("click",function(){b.showOrHideSubmissionDetails(this)})},error:function(a,b,c){$(".competition_submissions").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};b.getPhaseResults=function(a,b){$(".competition_results").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",
display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/results/"+b,cache:!1,success:function(a){$(".competition_results").html("").append(a);$(".column-selectable").click(function(a){a=$(this).closest("table");$(a).find(".column-selected").removeClass();$(this).addClass("column-selected");var b=$(this).attr("name");a=a.find("td").filter(function(){return $(this).attr("name")===b}).addClass("column-selected");if(0<a.length)for(var c=a.slice().sort(function(a,b){var c=parseInt($.text([$(a).find("span")]));
isNaN(c)&&(c=1E5);var d=parseInt($.text([$(b).find("span")]));isNaN(d)&&(d=1E5);return c-d}),f=a[0].parentNode.parentNode,c=c.map(function(){return this.parentNode.cloneNode(!0)}),d=0;d<c.length;d++)$(c[d]).find("td.row-position").text($(c[d]).find("td.column-selected span").text()),f.insertBefore(c[d],a[d].parentNode),f.removeChild(a[d].parentNode)})},error:function(a,b,c){$(".competition_results").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};b.registationCanProceed=
function(){!0===$("#checkbox").is(":checked")?$("#participateButton").removeClass("disabledStatus"):$("#participateButton").addClass("disabledStatus")};b.displayRegistrationStatus=function(a){var b="";$.ajax({type:"GET",url:"/api/competition/"+a+"/mystatus/",cache:!1,success:function(a){console.log(a);"approved"==a.status?location.reload():"pending"==a.status?(b="<div class='participateInfoBlock pendingApproval'>",b+="<div class='infoStatusBar'></div>",b+="<div class='labelArea'>",b+="<label class='regApprovLabel'>Your request to participate in this challenge has been received and a decision is pending.</label>",
b+="<label></label>",b+="</div>",b+="</div>"):"denied"==a.status&&(b="<div class='participateInfoBlock'>",b+="<div class='infoStatusBar'></div>",b+="<div class='labelArea'>",b+="<label class='regDeniedLabel'>Your request to participate in this challenge has been denied. The reason for your denied registrations is: "+a.reason+"</label>",b+="<label></label>",b+="</div>",b+="</div>");location.reload()},error:function(a,b,c){$(".competition_results").html("<div class='alert - error'>An error occurred. Please try refreshing the page.</div>")}});
return b};b.displayNewSubmission=function(a){var c=$("#submission_details_template #submission_row_template tr").clone();$(c).attr("id",a.id.toString());$(c).addClass(b.oddOrEven(a.submission_number));$(c).children().each(function(d){switch(d){case 0:"finished"===a.status&&($(this).val("1"),0<$("#forced_to_leaderboard").length&&($(".fi-check").remove(),$($(c).children("td")[4]).html('<i class="fi-check"></i>')));break;case 1:$(this).html(a.submission_number.toString());break;case 2:$(this).html(a.filename);
break;case 3:var e=function(a){a=a.toString();1==a.length&&(a="0"+a);return a},g=new Date(a.submitted_at);d=g.getDate().toString()+"/"+g.getMonth().toString()+"/"+g.getFullYear();var l=g.getHours().toString(),k=e(g.getMinutes()),e=e(g.getSeconds());$(this).html(d+" "+l+":"+k+":"+e);break;case 4:$(this).html(b.getSubmissionStatus(a.status))}});return c};b.oddOrEven=function(a){return a&1?"odd":"even"};b.getSubmissionStatus=function(a){var b="Unknown";"submitting"===a?b="Submitting":"submitted"===a?
b="Submitted":"running"===a?b="Running":"failed"===a?b="Failed":"cancelled"===a?b="Cancelled":"finished"===a&&(b="Finished");return b};b.showOrHideSubmissionDetails=function(a){var c=$(a).parents("tr")[0];if($(a).hasClass("fi-minus"))$(a).removeClass("fi-minus"),$(a).addClass("fi-plus"),$(c).next("tr.trDetails").remove();else{$(a).removeClass("fi-plus");$(a).addClass("fi-minus");a=$("#submission_details_template .trDetails").clone();a.find(".tdDetails").attr("colspan",c.cells.length);a.find("a").each(function(a){$(this).attr("href",
$(this).attr("href").replace("_",c.id))});var f=$("#phasestate").val(),h=$(c).find("input[name='state']").val();if(1==f&&1==h){var g=a.find("button");g.removeClass("hide");var f=$(c).find(".status").hasClass("submitted"),l=$("#competitionId").val();e(g,f);g.on("click",function(){d(l,c.id,$("#cstoken").val(),g)})}else{f=$.trim($(c).find(".statusName").html());g=a.find("button").addClass("hide");if("Submitting"===f||"Submitted"===f||"Running"===f)g.removeClass("hide"),g.text("Refresh status"),console.log("----\x3e "+
c.id),g.on("click",function(){b.updateSubmissionStatus($("#competitionId").val(),c.id,this)});"Failed"!==f&&"Cancelled"!==f||a.find("a").removeClass("hide")}$(c).after(a)}};b.updateSubmissionStatus=function(a,c,f){$(f).parents(".submission_details").find(".preloader-handler").append("<div class='competitionPreloader'></div>").children().css({top:"25px",display:"block"});$.ajax({type:"GET",url:"/api/competition/"+a+"/submission/"+c,cache:!1,success:function(e){$("#user_results #"+c).find(".statusName").html(b.getSubmissionStatus(e.status));
if("finished"===e.status)$("#user_results #"+c+"input:hidden").val("1"),1==$("#phasestate").val()?(0==$("#forced_to_leaderboard").length?($(f).addClass("leaderBoardSubmit"),$(f).text("Submit to Leaderboard")):($(".fi-check").remove(),$($("#"+c+" td")[4]).html('<i class="fi-check"></i>'),$(f).removeClass("leaderBoardSubmit"),$(f).addClass("leaderBoardRemove"),$(f).text("Remove from Leaderboard")),$(f).unbind("click").off("click").on("click",function(){d(a,c,$("#cstoken").val(),$(f))})):$(f).addClass("hide");
else if("failed"===e.status||"cancelled"===e.status)$(f).addClass("hide"),$(f).parent().parent().find("a").removeClass("hide");$(".competitionPreloader").hide()},error:function(a,b,c){}})};b.initialize=function(){$(document).ready(function(){$("#participate_form").submit(function(a){a.preventDefault();if($("#participateButton").hasClass("disabledStatus"))return!1;$("#result").html("");a=$(this).serialize();var d=$("#competitionId").val();request=$.ajax({url:"/api/competition/"+d+"/participate/",type:"post",
dataType:"text",data:a,success:function(a,c,e){$(".content form").replaceWith(b.displayRegistrationStatus(d))},error:function(a,b,c){alert("There was a problem registering for this competition.")}});return!1});$("#submissions_phase_buttons .button").each(function(a,d){$(this).click(function(){var a=$.trim($(this).attr("id").replace("submissions_phase_",""));$("#submissions_phase_buttons .button").removeClass("selected");$(this).addClass("selected");var c=$("#competitionId").val(),d=$("#cstoken").val();
b.getPhaseSubmissions(c,a,d)})});$("a[href='#participate-submit_results']").click(function(a){b.invokePhaseButtonOnOpen("submissions_phase_buttons")});$("#results_phase_buttons .button").each(function(a,d){$(this).click(function(){var a=$.trim($(this).attr("id").replace("results_phase_",""));$("#results_phase_buttons .button").removeClass("selected");$(this).addClass("selected");var c=$("#competitionId").val();b.getPhaseResults(c,a)})});$("#Results").click(function(a){b.invokePhaseButtonOnOpen("results_phase_buttons")});
$(this).foundation("section","reflow");$(".top-bar-section ul > li").removeClass("active");$("#liCompetitions").addClass("active");$(".my_managing .competition-tile #competition-actions").each(function(a,b){$(this).children("#competition-publish-button").click(function(){var a=$(this).parent()[0];request=$.ajax({url:$(this)[0].value,success:function(b,c,d){console.log("Published competition.");$(a).children("#competition-publish-button").hide();$(a).children("#competition-delete-button").hide();$(a).children("#competition-unpublish-button").show()},
error:function(a,b,c){a=$.parseJSON(a.responseJSON);a.error&&alert(a.error);console.log("Error publishing competition!")}})});$(this).children("#competition-unpublish-button").click(function(){});"True"==$(this)[0].getAttribute("published")?($(this).children("#competition-delete-button").hide(),$(this).children("#competition-publish-button").hide(),$(this).children("#competition-unpublish-button").show()):($(this).children("#competition-delete-button").show(),$(this).children("#competition-publish-button").show(),
$(this).children("#competition-unpublish-button").hide())});var a=window.location.href;void 0!==a&&(null!==a.match(/#participate-submit_results$/i)?b.invokePhaseButtonOnOpen("submissions_phase_buttons"):null!==a.match(/#results$/i)&&b.invokePhaseButtonOnOpen("results_phase_buttons"))})}})(Competition||(Competition={}));var csrftoken;function csrfSafeMethod(b){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(b)}function sameOrigin(b){var e="//"+document.location.host,d=document.location.protocol+e;return b==d||b.slice(0,d.length+1)==d+"/"||b==e||b.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(b)}$(function(){csrftoken=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(b,e){!csrfSafeMethod(e.type)&&sameOrigin(e.url)&&b.setRequestHeader("X-CSRFToken",csrftoken)}})});var CodaLab;
(function(b){var e=function(){function b(a){var c=this;this.defaultOptions={buttonId:"fileUploadButton",disabledClassName:"disabled",beforeSelection:function(){},afterSelection:function(a,b){},uploadProgress:function(a,b,c){},uploadSuccess:function(a){},uploadError:function(a){},allowedFileTypes:void 0,extensionToFileType:{zip:"application/zip"},maxFileSizeInBytes:void 0,maxBlockSizeInBytes:1048576};this.options=$.extend({},this.defaultOptions,a);var d=$("#"+this.options.buttonId);this.setupFileInput();
d.after(this.fileInput);d.on("click",function(a){d.hasClass(c.options.disabledClassName)||c.fileInput.click()})}b.prototype.setupFileInput=function(){var a=this,c=this.fileInput;this.fileInput=$(document.createElement("input"));this.fileInput.attr("type","file");this.fileInput.attr("style","visibility: hidden; width: 1px; height: 1px;");this.fileInput.on("change",function(c){a.options.beforeSelection();c=a.validate();var e=0<c.files.length&&!0===b.selectionIsValid(c);a.options.afterSelection(c,e);
e?a.beginUpload(c,0):a.setupFileInput()});void 0!==c&&c.replaceWith(this.fileInput)};b.prototype.validate=function(){var a=this,b=this.fileInput.get(0).files,d=[];0<b.length&&$.each(b,function(b,c){var e=[];a.options.maxFileSizeInBytes&&c.size>a.options.maxFileSizeInBytes&&e.push({kind:"size-error"});var k=c.type;if(""===k){var m=c.name.split(".");1<m.length&&(k=a.options.extensionToFileType[m.pop().toLowerCase()])}a.options.allowedFileTypes&&-1===$.inArray(k,a.options.allowedFileTypes)&&e.push({kind:"type-error"});
d.push({file:c,errors:e})});return{files:d}};b.selectionIsValid=function(a){return 0===a.files.map(function(a){return a.errors.length}).reduce(function(a,b,d,e){return a+b},0)};b.prototype.getCurrentFile=function(){if(void 0!==this.state)return this.state.selection.files[this.state.fileIndex].file};b.prototype.getFileReader=function(){var a=this,b=new FileReader;b.onload=function(b){var c=a.state.sasUrl+"&comp=block&blockid="+a.state.blockIds[a.state.blockIds.length-1];b=new Uint8Array(b.target.result);
var d=a.state.sasVersion;$.ajax({url:c,type:"PUT",data:b,processData:!1,beforeSend:function(a){a.setRequestHeader("x-ms-version",d);a.setRequestHeader("x-ms-blob-type","BlockBlob")},success:function(b,c){var d=a.getCurrentFile();a.options.uploadProgress(d,a.state.bytesUploaded,d.size);a.state.bytesUploaded<d.size?a.upload():a.endUpload()},error:function(b,c,d){a.options.uploadError({kind:"write-error",jqXHR:b,file:a.getCurrentFile()})}})};b.onerror=function(b){a.options.uploadError({kind:"read-error",
message:b.message,file:a.getCurrentFile()})};return b};b.prototype.beginUpload=function(a,b){this.state={sasUrl:void 0,sasVersion:void 0,trackingId:void 0,reader:void 0,selection:a,fileIndex:b,blockIds:[],bytesUploaded:0};var d=this.getCurrentFile(),e=this;$.ajax({url:e.options.sasEndpoint,type:"POST",data:{name:d.name,type:d.type,size:d.size},success:function(a,b){e.state.sasUrl=a.url;e.state.sasVersion=a.version;e.state.trackingId=a.id;e.state.reader=e.getFileReader();e.options.uploadProgress(d,
e.state.bytesUploaded,d.size);e.upload()},error:function(a,b,c){e.options.uploadError({kind:"sas-error",jqXHR:a,file:e.getCurrentFile()})}})};b.prototype.upload=function(){var a=this.getCurrentFile(),b=this.state.bytesUploaded,d=b+Math.min(a.size-b,this.options.maxBlockSizeInBytes),a=a.slice(b,d),b="000000"+(this.state.blockIds.length+1),b=btoa(b.substring(b.length-6));this.state.blockIds.push(b);this.state.bytesUploaded=d;this.state.reader.readAsArrayBuffer(a)};b.prototype.endUpload=function(){var a=
this.state.sasUrl+"&comp=blocklist",b=this.getCurrentFile(),d=['<?xml version="1.0" encoding="utf-8"?>'];d.push("<BlockList>");for(var e=0;e<this.state.blockIds.length;e++)d.push("  <Latest>"+this.state.blockIds[e]+"</Latest>");d.push("</BlockList>");var g=this;$.ajax({url:a,type:"PUT",contentType:"application/xml",processData:!1,data:d.join("\n"),beforeSend:function(a){a.setRequestHeader("x-ms-version",g.state.sasVersion);a.setRequestHeader("x-ms-blob-content-type",b.type);a.setRequestHeader("x-ms-meta-name",
b.name);a.setRequestHeader("x-ms-meta-size",b.size.toString())},success:function(a,d){g.options.uploadSuccess(b,g.state.trackingId);var e=1+g.state.fileIndex;e<g.state.selection.files.length?g.beginUpload(g.state.selection,e):g.setupFileInput()},error:function(a,b,c){g.options.uploadError({kind:"write-error",jqXHR:a,file:g.getCurrentFile()})}})};b.isSupported=function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1};return b}();b.FileUploader=e;(function(b){b.CreateReady=
function(){!1===e.isSupported()?($("#uploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new e({buttonId:"uploadButton",sasEndpoint:"/api/competition/create/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,b){$("#uploadButton").addClass("disabled")},afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?
$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#uploadButton").removeClass("disabled"))},uploadProgress:function(a,b,d){b=100*b/d;$("#details").html("Uploading file <em>"+a.name+"</em>: "+b.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#uploadButton").removeClass("disabled")},uploadSuccess:function(a,
b){$("#details").html("Creating competition... This may take a while. Please be patient.");$.ajax({url:"/api/competition/create",type:"post",cache:!1,data:{id:b,name:a.name,type:a.type,size:a.size}}).done(function(a){var b=function(){$.ajax({url:"/api/competition/create/"+a.token,type:"get",cache:!1,data:{csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val()}}).done(function(a){"finished"==a.status?($("#details").html("Congratulations! Your new competition is ready to <a href='/competitions/"+
a.id+"'>view</a>. You can also manage it from <a href='/my/#manage'>your CodaLab dashboard.</a>"),$("#uploadButton").removeClass("disabled")):"failed"==a.status?($("#details").html("Oops! There was a problem creating the competition."),$("#uploadButton").removeClass("disabled")):setTimeout(b,1E3)}).fail(function(){$("#details").html("An unexpected error occurred.");$("#uploadButton").removeClass("disabled")})};b()}).fail(function(){$("#details").html("An unexpected error occurred.");$("#uploadButton").removeClass("disabled")})}})}})(b.Competitions||
(b.Competitions={}))})(CodaLab||(CodaLab={}));angular.module("codalab.services",[]);angular.module("codalab.controllers",[]);angular.module("codalab.directives",[]);
angular.module("codalab",["ngRoute","ngAnimate","codalab.controllers","codalab.services","codalab.directives"]).factory("$exceptionHandler",function(){return function(b){console.error(b.message);error(b)}}).config(["$routeProvider","$locationProvider","$httpProvider","$interpolateProvider",function(b,e,d,a){b.when("/worksheets/app/:uuid/",{templateUrl:"/static/app/partials/worksheet.html",controller:"worksheet"}).when("/my",{templateUrl:"/static/app/partials/myworksheets.html",controller:"worksheets"}).otherwise({templateUrl:"/static/app/partials/worksheets.html",
controller:"worksheets"});e.html5Mode(!0);a.startSymbol("{[{");a.endSymbol("}]}")}]);angular.module("codalab.services").factory("worksheetsApi",["$http",function(b){var e=function(a,b,d,e){return a.data},d=function(a,b,d,e){throw a;},a=function(a){return function(){return b.get(a+"?preventCache="+Math.floor(1E3*Math.random())).then(e,d)}};return{info:a("/api/worksheets/info/"),worksheets:a("/api/worksheets/"),createWorksheet:function(a){return function(f){var h=$.cookie("csrftoken");!csrfSafeMethod("POST")&&sameOrigin(a)&&(b.defaults.headers.common["X-CSRFToken"]=h);return b.post(a,
f).then(e,d)}}("/api/worksheets/")}}]);angular.module("codalab.controllers").controller("root",["$scope","worksheetsApi",function(b,e){e.info().then(function(d){b.config=d.config;b.user=d.user})}]);angular.module("codalab.controllers").controller("worksheets",["$scope","$location","worksheetsApi",function(b,e,d){b.status="loading";b.selectionIndex=0;b.worksheets=[];b.statusMessage=function(a){var c={"":"",loading:"Loading worksheets...",loaderror:"Couldn't retrieve worksheets - Try refreshing the page",empty:"There are no worksheets.",saving:"Saving",saveerror:"Couldn't save - Try a different name"};switch(a){case "loaded":return 0<b.worksheets.length?"":c.empty}return c[a]};b.hasStatus=function(a){return a&&
0<a.length};d.worksheets().then(function(a){b.status="loaded";0===e.path().indexOf("/my")&&(a=a.filter(function(a){return a.owner===b.user.name}));angular.forEach(a,function(a){a.url="/worksheets/"+a.uuid;a.target="_self";a.editable=!1;var d=a.items.filter(function(a){return"title"==a.type});a.title=0<d.length?d[0].value:a.name;d=a.items.filter(function(a){return"description"==a.type});0<d.length&&d.forEach(function(b){a.description=b.value+"\n"});b.worksheets.push(a)})},function(){b.status="loaderror"});
b.saveWorksheet=function(a){a.status="saving";d.createWorksheet(a).then(function(b){a.name=b.name;a.title=b.name;a.uuid=b.uuid;a.owner=b.owner;a.url="/worksheets/"+a.uuid;a.editable=!1;a.target="_self"},function(){a.status="saveerror"})};b.worksheetEnabled=function(a){return 0<a.name.length};b.addWorksheet=function(a,c){b.selectionIndex=a+(c?1:0);b.worksheets.splice(b.selectionIndex,0,{name:"",editable:!0,url:"#",owner:b.user.name})};b.keyPressed=function(a){if(a.ctrlKey)switch(a.keyCode){case 38:case 40:b.user.authenticated&&
(b.addWorksheet(b.selectionIndex,40===a.keyCode),a.preventDefault())}else switch(a.keyCode){case 38:b.selectionIndex=0<b.selectionIndex?b.selectionIndex-1:0;a.preventDefault();break;case 40:b.selectionIndex=b.selectionIndex<b.worksheets.length-1?b.selectionIndex+1:b.worksheets.length-1,a.preventDefault()}};b.gotFocus=function(a){b.selectionIndex=a};b.lostFocus=function(a){b.selectionIndex===a&&(b.selectionIndex=b.selectionIndex===b.worksheets.length-1?b.selectionIndex=b.worksheets.length:-1)}}]);angular.module("codalab.controllers").controller("worksheet",["$scope","worksheetsApi",function(b,e){b.status="Loading worksheet..."}]);angular.module("codalab.directives").directive("shortcut",function(){return{restrict:"E",replace:!0,scope:!0,link:function(b,e,d){var a=function(a){b.$apply(b.keyPressed(a))};$(document).on("keydown",a);b.$on("$destroy",function(){$(document).off("keydown",a)})}}});angular.module("codalab.directives").directive("setFocus",["$timeout",function(b){return{scope:{trigger:"@setFocus"},restrict:"A",link:function(e,d,a){a.$observe("setFocus",function(a){"true"===a&&document.activeElement!=d&&b(function(){"true"===e.trigger&&(d[0].focus(),e.trigger=!1)})})}}}]);angular.module("codalab.directives").directive("scrollIntoView",["$timeout",function(b){return{scope:{trigger:"@scrollIntoView"},restrict:"A",link:function(e,d,a){a.$observe("scrollIntoView",function(a,f){"true"===a&&a!==f&&b(function(){"true"===e.trigger&&(d[0].scrollIntoView(),e.trigger=!1)})})}}}]);//# sourceMappingURL=/static/codalab.min.map
